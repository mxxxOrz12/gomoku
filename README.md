

# C++ 控制台五子棋 (Gomoku) 项目说明文档

## 1. 项目简介

本项目是一个基于 C++ 开发的控制台版五子棋游戏。项目实现了标准的五子棋对战逻辑，支持 **人人对战** 和 **人机对战 (PvE)** 两种模式。

为了增加游戏的专业性，本项目实现了 **禁手规则 (Renju Rules)**，并在人机对战中实现了基于 **Minimax (极大极小值)** 算法配合 **Alpha-Beta 剪枝** 的 AI 智能对手。

## 2. 文件结构

项目采用模块化设计，将声明与实现分离，共包含三个核心文件：

| 文件名 | 类型 | 描述 |
| :--- | :--- | :--- |
| **`gomoku.h`** | 头文件 | 包含 `Board` 和 `GomokuGame` 类的声明、常量定义 (棋盘大小、符号) 及数据结构定义。 |
| **`gomoku.cpp`** | 源文件 | 包含核心逻辑的具体实现，如胜负判断、禁手检测、AI 搜索算法及界面绘制。 |
| **`main.cpp`** | 主程序 | 程序的入口，负责控制台编码设置 (UTF-8) 以及主菜单的逻辑循环。 |

## 3. 核心类与功能模块

### 3.1 Board 类 (棋盘逻辑核心)
该类负责维护棋盘数据和底层规则判断。

*   **数据存储**：使用 `vector<vector<int>>` 二维数组存储 15x15 的棋盘状态。
*   **胜负判定 (`checkWin`)**：在落子后，向四个方向（横、竖、主对角、副对角）扫描，检测是否有五子连珠。
*   **禁手规则 (`checkForbiddenMoves`)**：针对黑棋（先行方）实现的限制规则，以维持游戏平衡：
    *   **三三禁手**：禁止同时形成两个活三。
    *   **四四禁手**：禁止同时形成两个四（活四或冲四）。
    *   **长连禁手**：禁止一条线上形成超过 5 个黑子。
    *   *注：若落子同时形成五连和禁手，五连优先（判赢）。*
*   **局势评估 (`evaluateBoard`)**：AI 专用的估值函数，扫描全盘，对连续棋型（如活四、活三）进行打分，正分代表白棋优势，负分代表黑棋优势。

### 3.2 GomokuGame 类 (游戏流程控制)
该类负责管理游戏状态和用户交互。

*   **界面绘制 (`printBoard`)**：
    *   使用 UTF-8 字符优化视觉体验。
    *   **棋子**：黑棋 `X`，白棋 `0`。
    *   **空位**：使用  `+` 保持棋盘对齐。
*   **输入处理**：处理玩家坐标输入，包含边界检查和非法落子提示。
*   **游戏模式**：通过状态机管理 PvP 和 PvE 两种模式的切换。

## 4. AI 算法设计 (人机对战)

AI 的核心目标是模拟人类思考，通过计算寻找最优落子点。

### 4.1 算法架构
采用 **Minimax (极大极小值算法)** 配合 **Alpha-Beta 剪枝**。
*   **Max 层 (AI)**：寻找能使局势评分最大的步数。
*   **Min 层 (玩家)**：假设玩家极其聪明，会选择让 AI 评分最小（即玩家优势最大）的步数。
*   **Alpha-Beta 剪枝**：在搜索过程中，如果发现当前分支已经不如之前的选择（即产生了截断），则立即停止搜索该分支，大幅提高计算效率。

### 4.2 性能优化
由于 15x15 棋盘的搜索空间巨大，代码做了以下优化：
1.  **邻域剪枝 (`hasNeighbor`)**：AI 只搜索周围 1-2 格内有棋子的空位，忽略边缘孤立的空位。
2.  **深度控制**：搜索深度设定为 2-3 层，保证在控制台环境下的响应速度（秒级响应）。
3.  **启发式评分**：优先堵截玩家的“活三”和“冲四”，优先构建自己的“五连”。

## 5. 编译与运行

### 环境要求
*   支持 C++11 及以上标准的编译器 (如 GCC, Clang, MSVC)。
*   支持 UTF-8 显示的终端 (Windows 建议使用 Windows Terminal 或在 CMD 中设置代码页 65001)。

### 编译命令
在终端中执行以下命令生成可执行文件：

```bash
cd build
cmake ..
make -j4
```

### 运行
```bash
cd build
# Windows
.\bin\gomoku.exe
# Linux / Mac
./bin/gomoku
```

